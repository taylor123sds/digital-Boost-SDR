{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://leadly.ai/schemas/agent-config.schema.json",
  "title": "AgentConfig",
  "description": "Schema de configuracao completa para agentes da plataforma LEADLY",
  "type": "object",
  "required": ["id", "empresa", "agente"],
  "properties": {
    "id": {
      "type": "string",
      "description": "ID unico do agente",
      "pattern": "^[a-z0-9-_]+$"
    },
    "version": {
      "type": "string",
      "description": "Versao da configuracao",
      "default": "1.0.0"
    },
    "createdAt": {
      "type": "string",
      "format": "date-time"
    },
    "updatedAt": {
      "type": "string",
      "format": "date-time"
    },

    "empresa": {
      "type": "object",
      "description": "Dados da empresa cliente",
      "required": ["nome", "segmento"],
      "properties": {
        "nome": { "type": "string", "minLength": 1 },
        "segmento": { "type": "string" },
        "descricao": { "type": "string" },
        "site": { "type": "string", "format": "uri" },
        "cnpj": { "type": "string" },
        "logo": { "type": "string", "format": "uri" }
      }
    },

    "agente": {
      "type": "object",
      "description": "Configuracao do agente",
      "required": ["nome", "role", "vertical"],
      "properties": {
        "nome": {
          "type": "string",
          "description": "Nome do agente (ex: Luna, Max)",
          "minLength": 1
        },
        "role": {
          "type": "string",
          "description": "Funcao do agente",
          "enum": ["sdr", "specialist", "scheduler", "support"],
          "default": "sdr"
        },
        "vertical": {
          "type": "string",
          "description": "Vertical de atuacao",
          "enum": ["varejo", "servicos", "saas", "educacao", "saude"],
          "default": "servicos"
        },
        "objetivo": {
          "type": "string",
          "description": "Objetivo principal do agente"
        },
        "kpis": {
          "type": "array",
          "description": "KPIs de sucesso",
          "items": { "type": "string" }
        },
        "avatar": {
          "type": "string",
          "format": "uri",
          "description": "URL do avatar do agente"
        }
      }
    },

    "icp": {
      "type": "object",
      "description": "Ideal Customer Profile",
      "properties": {
        "segmentos": {
          "type": "array",
          "items": { "type": "string" }
        },
        "cargos_alvo": {
          "type": "array",
          "items": { "type": "string" }
        },
        "faturamento": {
          "type": "object",
          "properties": {
            "min": { "type": "string" },
            "max": { "type": "string" }
          }
        },
        "funcionarios": {
          "type": "object",
          "properties": {
            "min": { "type": "integer", "minimum": 0 },
            "max": { "type": "integer" }
          }
        },
        "regiao": {
          "type": "array",
          "items": { "type": "string" }
        },
        "sinais_compra": {
          "type": "array",
          "description": "Gatilhos de compra",
          "items": { "type": "string" }
        },
        "desqualificadores": {
          "type": "array",
          "description": "Criterios de desqualificacao",
          "items": { "type": "string" }
        }
      }
    },

    "qualificacao": {
      "type": "object",
      "description": "Framework BANT de qualificacao",
      "properties": {
        "framework": {
          "type": "string",
          "enum": ["bant", "meddic", "spin", "custom"],
          "default": "bant"
        },
        "criterios_obrigatorios": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": ["budget", "authority", "need", "timeline"]
          },
          "default": ["need", "authority"]
        },
        "criterios_desejaveis": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": ["budget", "authority", "need", "timeline"]
          }
        },
        "pontuacao_sql": {
          "type": "integer",
          "description": "Score minimo para SQL",
          "minimum": 0,
          "maximum": 100,
          "default": 60
        },
        "perguntas_customizadas": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "criterio": { "type": "string" },
              "pergunta": { "type": "string" },
              "peso": { "type": "integer", "minimum": 1, "maximum": 10 }
            }
          }
        }
      }
    },

    "catalogo": {
      "type": "array",
      "description": "Produtos ou servicos oferecidos",
      "items": {
        "type": "object",
        "required": ["id", "nome"],
        "properties": {
          "id": { "type": "string" },
          "nome": { "type": "string" },
          "descricao": { "type": "string" },
          "preco": { "type": "string" },
          "categoria": { "type": "string" },
          "beneficios": {
            "type": "array",
            "items": { "type": "string" }
          },
          "diferenciais": {
            "type": "array",
            "items": { "type": "string" }
          },
          "objecoes_comuns": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "objecao": { "type": "string" },
                "resposta": { "type": "string" }
              }
            }
          }
        }
      }
    },

    "brandVoice": {
      "type": "object",
      "description": "Tom e estilo de comunicacao",
      "properties": {
        "tom": {
          "type": "string",
          "enum": ["formal", "profissional", "casual", "descontraido"],
          "default": "profissional"
        },
        "tratamento": {
          "type": "string",
          "enum": ["voce", "senhor", "tu"],
          "default": "voce"
        },
        "emojis": {
          "type": "boolean",
          "default": false
        },
        "girias": {
          "type": "boolean",
          "default": false
        },
        "palavras_proibidas": {
          "type": "array",
          "items": { "type": "string" }
        },
        "palavras_preferidas": {
          "type": "array",
          "items": { "type": "string" }
        },
        "assinatura": {
          "type": "string",
          "description": "Assinatura padrao das mensagens"
        },
        "max_paragrafos": {
          "type": "integer",
          "description": "Maximo de paragrafos por resposta",
          "default": 3
        }
      }
    },

    "disponibilidade": {
      "type": "object",
      "description": "Horarios de atendimento",
      "properties": {
        "timezone": {
          "type": "string",
          "default": "America/Sao_Paulo"
        },
        "dias": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": ["seg", "ter", "qua", "qui", "sex", "sab", "dom"]
          },
          "default": ["seg", "ter", "qua", "qui", "sex"]
        },
        "horario": {
          "type": "object",
          "properties": {
            "inicio": { "type": "string", "pattern": "^[0-2][0-9]:[0-5][0-9]$" },
            "fim": { "type": "string", "pattern": "^[0-2][0-9]:[0-5][0-9]$" }
          },
          "default": { "inicio": "08:00", "fim": "18:00" }
        },
        "feriados": {
          "type": "array",
          "items": { "type": "string", "format": "date" }
        },
        "mensagem_fora_horario": {
          "type": "string"
        },
        "modo_fora_horario": {
          "type": "string",
          "enum": ["offline", "auto_resposta", "emergencia"],
          "default": "auto_resposta"
        }
      }
    },

    "agendamento": {
      "type": "object",
      "description": "Configuracao de agendamento",
      "properties": {
        "habilitado": { "type": "boolean", "default": true },
        "duracao_padrao": {
          "type": "integer",
          "description": "Duracao em minutos",
          "default": 30
        },
        "antecedencia_minima": {
          "type": "integer",
          "description": "Horas de antecedencia",
          "default": 2
        },
        "antecedencia_maxima": {
          "type": "integer",
          "description": "Dias de antecedencia",
          "default": 30
        },
        "buffer_entre_reunioes": {
          "type": "integer",
          "description": "Minutos entre reunioes",
          "default": 15
        },
        "link_calendario": {
          "type": "string",
          "format": "uri"
        },
        "tipos_reuniao": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "id": { "type": "string" },
              "nome": { "type": "string" },
              "duracao": { "type": "integer" },
              "descricao": { "type": "string" }
            }
          }
        }
      }
    },

    "canais": {
      "type": "object",
      "description": "Canais de comunicacao",
      "properties": {
        "whatsapp": {
          "type": "object",
          "properties": {
            "habilitado": { "type": "boolean", "default": true },
            "numero": { "type": "string" },
            "instance": { "type": "string" },
            "provider": {
              "type": "string",
              "enum": ["evolution", "meta_cloud", "baileys"],
              "default": "evolution"
            }
          }
        },
        "email": {
          "type": "object",
          "properties": {
            "habilitado": { "type": "boolean", "default": false },
            "remetente": { "type": "string", "format": "email" },
            "smtp": { "type": "string" }
          }
        },
        "chat": {
          "type": "object",
          "properties": {
            "habilitado": { "type": "boolean", "default": false },
            "widget_id": { "type": "string" }
          }
        },
        "instagram": {
          "type": "object",
          "properties": {
            "habilitado": { "type": "boolean", "default": false },
            "account_id": { "type": "string" }
          }
        }
      }
    },

    "handoff": {
      "type": "object",
      "description": "Regras de transferencia para humano",
      "properties": {
        "vendedor_responsavel": { "type": "string" },
        "email_responsavel": { "type": "string", "format": "email" },
        "telefone_responsavel": { "type": "string" },
        "canal_notificacao": {
          "type": "string",
          "enum": ["whatsapp", "email", "slack", "webhook"],
          "default": "whatsapp"
        },
        "webhook_url": { "type": "string", "format": "uri" },
        "criterios_escalacao": {
          "type": "array",
          "description": "Quando escalar para humano",
          "items": { "type": "string" },
          "default": ["cliente_irritado", "problema_tecnico", "solicitacao_juridica"]
        },
        "tempo_resposta_sla": {
          "type": "integer",
          "description": "SLA em minutos",
          "default": 60
        }
      }
    },

    "conhecimento": {
      "type": "object",
      "description": "Base de conhecimento",
      "properties": {
        "faqs": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["pergunta", "resposta"],
            "properties": {
              "id": { "type": "string" },
              "categoria": { "type": "string" },
              "pergunta": { "type": "string" },
              "resposta": { "type": "string" },
              "keywords": {
                "type": "array",
                "items": { "type": "string" }
              },
              "acao": {
                "type": "string",
                "enum": ["resposta", "link", "handoff"]
              }
            }
          }
        },
        "documentos": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "id": { "type": "string" },
              "titulo": { "type": "string" },
              "conteudo": { "type": "string" },
              "categoria": { "type": "string" },
              "embedding_id": { "type": "string" }
            }
          }
        },
        "links_uteis": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "titulo": { "type": "string" },
              "url": { "type": "string", "format": "uri" },
              "descricao": { "type": "string" }
            }
          }
        }
      }
    },

    "compliance": {
      "type": "object",
      "description": "Regras de compliance e seguranca",
      "properties": {
        "lgpd_consentimento": { "type": "boolean", "default": true },
        "opt_out_keywords": {
          "type": "array",
          "items": { "type": "string" },
          "default": ["parar", "sair", "cancelar", "nao quero"]
        },
        "dados_sensiveis_permitidos": {
          "type": "array",
          "items": { "type": "string" }
        },
        "mensagem_opt_out": { "type": "string" },
        "aviso_gravacao": { "type": "boolean", "default": false },
        "retencao_dados_dias": {
          "type": "integer",
          "default": 365
        },
        "blacklist_dominios": {
          "type": "array",
          "items": { "type": "string" }
        }
      }
    },

    "integracao": {
      "type": "object",
      "description": "Integracoes externas",
      "properties": {
        "crm": {
          "type": "object",
          "properties": {
            "provider": {
              "type": "string",
              "enum": ["pipedrive", "hubspot", "salesforce", "rdstation", "interno"]
            },
            "api_key": { "type": "string" },
            "base_url": { "type": "string" }
          }
        },
        "calendario": {
          "type": "object",
          "properties": {
            "provider": {
              "type": "string",
              "enum": ["google", "outlook", "calendly", "cal_com", "interno"]
            },
            "credentials_path": { "type": "string" }
          }
        },
        "analytics": {
          "type": "object",
          "properties": {
            "provider": { "type": "string" },
            "tracking_id": { "type": "string" }
          }
        }
      }
    },

    "capabilities": {
      "type": "object",
      "description": "Capacidades do agente",
      "properties": {
        "tools": {
          "type": "array",
          "description": "Ferramentas disponiveis",
          "items": {
            "type": "string",
            "enum": [
              "calendar_check",
              "calendar_schedule",
              "send_email",
              "search_faq",
              "check_lead_history",
              "update_lead_stage",
              "send_whatsapp",
              "search_products",
              "calculate_quote",
              "handoff_human"
            ]
          }
        },
        "permissions": {
          "type": "object",
          "properties": {
            "can_schedule": { "type": "boolean", "default": true },
            "can_send_files": { "type": "boolean", "default": false },
            "can_access_crm": { "type": "boolean", "default": true },
            "can_modify_lead": { "type": "boolean", "default": true },
            "can_escalate": { "type": "boolean", "default": true }
          }
        }
      }
    },

    "stateMachine": {
      "type": "object",
      "description": "Configuracao da maquina de estados",
      "properties": {
        "initial": { "type": "string" },
        "states": {
          "type": "object",
          "additionalProperties": {
            "type": "object",
            "properties": {
              "name": { "type": "string" },
              "description": { "type": "string" },
              "transitions": {
                "type": "object",
                "additionalProperties": { "type": "string" }
              },
              "actions": {
                "type": "array",
                "items": { "type": "string" }
              }
            }
          }
        }
      }
    }
  }
}
