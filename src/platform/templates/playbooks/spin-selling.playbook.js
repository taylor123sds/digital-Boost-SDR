/**
 * SPIN SELLING PLAYBOOK
 * Metodologia de vendas consultivas baseada em perguntas estrategicas
 *
 * SPIN = Situation, Problem, Implication, Need-Payoff
 */

export const SPIN_PLAYBOOK = `
## METODOLOGIA SPIN SELLING

### Fundamento
SPIN Selling e uma metodologia de vendas consultivas desenvolvida por Neil Rackham.
Baseia-se em fazer perguntas estrategicas para guiar o cliente a descobrir
suas proprias necessidades e o valor da solucao.

### Principios Fundamentais
1. **Venda consultiva** - Ajude o cliente a pensar, nao empurre produto
2. **Perguntas > Argumentos** - Quem pergunta, controla
3. **Descoberta conjunta** - O cliente descobre a necessidade, nao voce impoe
4. **Valor percebido** - O cliente articula o valor, nao voce

---

## ETAPAS SPIN

### S - SITUATION (Situacao)
**Objetivo:** Entender o contexto atual do cliente

**Quando usar:** Inicio da conversa, para coletar fatos basicos

**Caracteristicas:**
- Perguntas factuais e objetivas
- Nao geram insight, apenas informacao
- Use com moderacao (max 2-3 perguntas)

**Exemplos:**
- "Como funciona o processo de [area] hoje na empresa?"
- "Quantas pessoas estao envolvidas nessa operacao?"
- "Que ferramentas voces usam atualmente para isso?"
- "Ha quanto tempo trabalham dessa forma?"
- "Quem e responsavel por essa area?"

**Cuidados:**
- Nao exagere - muitas perguntas de situacao cansam
- Pesquise antes para fazer menos perguntas basicas
- Use para transicao para perguntas de problema

---

### P - PROBLEM (Problema)
**Objetivo:** Identificar dores, dificuldades e insatisfacoes

**Quando usar:** Apos entender a situacao, para explorar gaps

**Caracteristicas:**
- Perguntas que revelam problemas
- Geram consciencia de dor
- Cliente comeca a perceber gaps

**Exemplos:**
- "Qual o maior desafio que voces enfrentam com isso?"
- "O que nao funciona tao bem quanto gostaria?"
- "Onde voce sente que perde mais tempo/dinheiro?"
- "O que te frustra nesse processo atual?"
- "Se pudesse mudar uma coisa, o que seria?"

**Cuidados:**
- Nao pare aqui - problema identificado nao e suficiente
- Use tom empatetico, nao interrogativo
- Deixe o cliente elaborar

---

### I - IMPLICATION (Implicacao)
**Objetivo:** Expandir a percepcao do impacto do problema

**Quando usar:** Apos identificar problema, para ampliar urgencia

**Caracteristicas:**
- Perguntas que exploram consequencias
- Conectam problema a impactos maiores
- Aumentam a dor percebida
- Criam urgencia para resolver

**Exemplos:**
- "Como isso afeta os resultados da equipe/empresa?"
- "Quanto isso esta custando em termos de [tempo/dinheiro/oportunidades]?"
- "O que acontece se isso continuar assim por mais 6 meses?"
- "Como isso impacta outras areas do negocio?"
- "Qual o custo de nao resolver esse problema?"

**Cuidados:**
- Esta e a etapa mais importante e mais negligenciada
- Nao tenha medo de ampliar a dor - e necessario
- Ajude o cliente a ver o "iceberg completo"

---

### N - NEED-PAYOFF (Necessidade-Beneficio)
**Objetivo:** Fazer o cliente articular o valor da solucao

**Quando usar:** Apos ampliar implicacoes, antes de apresentar solucao

**Caracteristicas:**
- Perguntas que focam em beneficios
- Cliente articula o valor, nao voce
- Cria comprometimento com a solucao
- Prepara terreno para proposta

**Exemplos:**
- "O que mudaria se voces conseguissem resolver isso?"
- "Como seria ter [resultado desejado]?"
- "Qual impacto teria resolver [problema] para voces?"
- "Se pudessemos ajudar com [X], como isso afetaria [Y]?"
- "Por que e importante resolver isso agora?"

**Cuidados:**
- Deixe o CLIENTE dizer o valor, nao voce
- Quanto mais o cliente fala de beneficios, mais comprometido
- Use as palavras do cliente na proposta

---

## FLUXO DE CONVERSA SPIN

### Fase 1: Abertura (1-2 mensagens)
- Rapport rapido
- Contextualize por que esta conversando
- Peca permissao para fazer perguntas

**Exemplo:**
"Oi [Nome]! Tudo bem? Vi que voce demonstrou interesse em [contexto].
Antes de falar sobre como podemos ajudar, posso te fazer algumas perguntas
para entender melhor sua situacao?"

### Fase 2: Situation (1-2 perguntas)
- Colete fatos basicos
- Entenda o contexto
- Transicione para problemas

### Fase 3: Problem (2-3 perguntas)
- Explore dores
- Identifique gaps
- Valide entendimento

### Fase 4: Implication (2-3 perguntas)
- Amplie consequencias
- Conecte a impactos financeiros/estrategicos
- Crie urgencia natural

### Fase 5: Need-Payoff (1-2 perguntas)
- Faca cliente articular valor
- Conecte necessidades a solucao
- Prepare transicao para proposta

### Fase 6: Proposta/Agendamento
- Resuma o que entendeu
- Conecte solucao as necessidades articuladas
- Proponha proximo passo

---

## PERGUNTAS POR CONTEXTO

### Para SaaS/Tecnologia
**Situation:**
- "Que sistemas voces usam hoje para [processo]?"
- "Como a equipe faz [atividade] atualmente?"

**Problem:**
- "Onde voces perdem mais tempo nesse processo?"
- "O que mais gera retrabalho?"

**Implication:**
- "Quanto tempo a equipe gasta com isso por semana?"
- "Como isso afeta a produtividade geral?"

**Need-Payoff:**
- "Se automatizassemos isso, o que a equipe faria com o tempo liberado?"

### Para Servicos B2B
**Situation:**
- "Como voces contratam esse tipo de servico hoje?"
- "Quem esta envolvido na decisao?"

**Problem:**
- "O que nao tem funcionado com fornecedores anteriores?"
- "Qual resultado esperavam e nao conseguiram?"

**Implication:**
- "Como isso afetou os projetos/entregas?"
- "Qual foi o custo desses problemas?"

**Need-Payoff:**
- "O que um parceiro ideal deveria entregar diferente?"

### Para Consultoria/Agencias
**Situation:**
- "Como esta estruturada a area de [marketing/vendas/etc]?"
- "Ja trabalharam com consultoria antes?"

**Problem:**
- "Onde sentem que estao deixando dinheiro na mesa?"
- "O que tem impedido de crescer mais rapido?"

**Implication:**
- "Quanto em receita estimam estar perdendo?"
- "O que acontece se continuarem no ritmo atual?"

**Need-Payoff:**
- "Se dobrasse [metrica], qual impacto no negocio?"

---

## TRANSICOES ENTRE ETAPAS

### S -> P (Situacao para Problema)
- "Interessante. E nesse processo, o que nao funciona tao bem?"
- "Entendi. E qual o principal desafio que voces enfrentam?"

### P -> I (Problema para Implicacao)
- "E como isso tem afetado [resultados/equipe/negocio]?"
- "Quando isso acontece, quais as consequencias?"

### I -> N (Implicacao para Need-Payoff)
- "Se pudessemos resolver isso, o que mudaria para voces?"
- "Pensando no impacto que voce mencionou, o que seria ideal?"

### N -> Proposta
- "Pelo que entendi, voces precisam de [necessidades]. E resolver isso teria [beneficios].
  Nosso [produto/servico] faz exatamente isso. Faz sentido conversarmos mais a fundo?"

---

## SINAIS DE COMPRA

### Sinais Positivos (Avancar)
- Cliente elabora muito nas respostas
- Cliente faz perguntas sobre a solucao
- Cliente menciona prazos ou urgencia
- Cliente fala em primeira pessoa ("preciso", "quero")
- Cliente pede proposta ou precos

### Sinais Negativos (Ajustar)
- Respostas curtas e evasivas
- Cliente muda de assunto
- Cliente minimiza os problemas
- Cliente menciona muitas barreiras
- Cliente nao ve implicacoes

---

## ERROS COMUNS

1. **Muitas perguntas de Situacao**
   - Parece interrogatorio
   - Pesquise antes

2. **Pular Implicacao**
   - Problema sem impacto = baixa urgencia
   - Invista tempo aqui

3. **Voce fala os beneficios**
   - Perde poder de Need-Payoff
   - Deixe o cliente dizer

4. **Pressionar antes da hora**
   - SPIN constroi desejo gradualmente
   - Respeite o tempo

5. **Nao ouvir as respostas**
   - Use as palavras do cliente
   - Construa sobre o que ele diz
`;

/**
 * Perguntas SPIN organizadas por categoria
 */
export const SPIN_QUESTIONS = {
  situation: {
    geral: [
      'Como funciona o processo de {{area}} hoje na empresa?',
      'Quantas pessoas estao envolvidas nessa operacao?',
      'Que ferramentas/sistemas voces usam atualmente?',
      'Ha quanto tempo trabalham dessa forma?',
      'Quem e responsavel por essa area?',
    ],
    tech: [
      'Que sistemas voces usam hoje para {{processo}}?',
      'Como a equipe faz {{atividade}} atualmente?',
      'Quanto tempo a equipe dedica a essa atividade?',
    ],
    services: [
      'Como voces contratam esse tipo de servico hoje?',
      'Ja trabalharam com fornecedores semelhantes antes?',
      'Quem participa da decisao de contratar?',
    ],
  },

  problem: {
    geral: [
      'Qual o maior desafio que voces enfrentam com isso?',
      'O que nao funciona tao bem quanto gostaria?',
      'Onde voce sente que perde mais tempo ou dinheiro?',
      'O que te frustra nesse processo atual?',
      'Se pudesse mudar uma coisa, o que seria?',
    ],
    tech: [
      'Onde voces perdem mais tempo nesse processo?',
      'O que mais gera retrabalho para a equipe?',
      'Quais problemas sao mais frequentes?',
    ],
    services: [
      'O que nao funcionou com fornecedores anteriores?',
      'Qual resultado esperavam e nao conseguiram?',
      'O que falta no servico atual?',
    ],
  },

  implication: {
    geral: [
      'Como isso afeta os resultados da equipe/empresa?',
      'Quanto isso esta custando em termos de {{recurso}}?',
      'O que acontece se isso continuar assim por mais 6 meses?',
      'Como isso impacta outras areas do negocio?',
      'Qual o custo de nao resolver esse problema?',
    ],
    financeiro: [
      'Quanto em receita estimam estar perdendo?',
      'Qual o custo operacional desse problema?',
      'Como isso afeta a margem do negocio?',
    ],
    estrategico: [
      'Como isso afeta a competitividade de voces?',
      'O que acontece se a concorrencia resolver isso primeiro?',
      'Como isso impacta os planos de crescimento?',
    ],
  },

  needPayoff: {
    geral: [
      'O que mudaria se voces conseguissem resolver isso?',
      'Como seria ter {{resultado_desejado}}?',
      'Qual impacto teria resolver {{problema}} para voces?',
      'Por que e importante resolver isso agora?',
      'O que um parceiro ideal deveria entregar?',
    ],
    valor: [
      'Quanto valeria resolver isso para a empresa?',
      'O que voces fariam com o tempo/recurso liberado?',
      'Como isso afetaria as metas do ano?',
    ],
  },
};

/**
 * Compila o playbook SPIN
 */
export function compileSPINPlaybook(config) {
  let playbook = SPIN_PLAYBOOK;

  playbook = playbook
    .replace(/\{\{agente\.nome\}\}/g, config.agente?.nome || 'Agente')
    .replace(/\{\{empresa\.nome\}\}/g, config.empresa?.nome || 'a empresa');

  return playbook.trim();
}

/**
 * Retorna perguntas SPIN por etapa e contexto
 */
export function getSPINQuestions(stage, context = 'geral', data = {}) {
  const questions = SPIN_QUESTIONS[stage]?.[context] || SPIN_QUESTIONS[stage]?.geral || [];

  return questions.map(q =>
    q.replace(/\{\{(\w+)\}\}/g, (match, key) => data[key] || `[${key}]`)
  );
}

/**
 * Detecta etapa SPIN baseado no contexto da conversa
 */
export function detectSPINStage(conversationContext) {
  const { hasBasicInfo, hasIdentifiedProblem, hasExploredImpact, hasArticulatedValue } = conversationContext;

  if (!hasBasicInfo) return 'situation';
  if (!hasIdentifiedProblem) return 'problem';
  if (!hasExploredImpact) return 'implication';
  if (!hasArticulatedValue) return 'needPayoff';

  return 'ready_to_propose';
}

export default {
  SPIN_PLAYBOOK,
  SPIN_QUESTIONS,
  compileSPINPlaybook,
  getSPINQuestions,
  detectSPINStage,
};
